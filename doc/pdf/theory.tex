\documentclass[a4paper,american,floatfix,pdftex,superscriptaddress,twoside,%
aps,pra,
% citeautoscript,% leave away for latexdiff
linenumbers,% remove for arXiv
% longbibliography,% not needed for revtex 4.2
% preprint,%
% galley,%
reprint,%final% add final to see real layout, no todonotes anymore, ...
]{revtex4-2}%
\usepackage{amsfonts,amsmath,amssymb}
\usepackage[T1]{fontenc}
\usepackage{graphicx}%
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{hyperref, hypernat}
\usepackage[displaymath,textmath,graphics]{preview}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\graphicspath{{./figures/}} % define figure directory

\newcommand{\cfeldesy}{\affiliation{Center for Free-Electron Laser Science, Deutsches
      Elektronen-Synchrotron DESY, Notkestra√üe 85, 22607 Hamburg, Germany}}%
\newcommand{\ezemail}{\email{emil.zak@cfel.de}}%


\begin{document}
\title{CHIRALEX: theory}

\author{Emil J.\ Zak}\ezemail\cfeldesy% 
\date{\today}%
\begin{abstract}\noindent%


\end{abstract}
\maketitle%

\section{Introduction}

Essential parameters are kept in the \textit{params} dictionary, which is passed throughout the program. It is used to construct all types of objects, from grids to the propagator object.

\section{basis functions and grids}

\subsection{Radial quadratures}

\subsection{Radial grid}

\subsection{Radial basis functions}

\subsubsection{Interpolated radial functions}

\subsection{Angular basis functions}


\section{index mapping}



\section{Rotated electrostatic potential}
Each molecular-frame orientation gives different electrostatic potential as seen from the laboratory frame, in which the basis set is defined. This means that for each orientation one must generate generally a different Lebedev quadrature grid. Even if a global scheme is used, the values of the electrostatic potential will be different at these points for each orientation. This is because the lebedev grid is defined in the laboratory frame. Therefore at this stage, a separate Psi4 calculation must be initialized for each orientation. I do not see a way around it at the moment, other than performing multipole expansion and calculating the angular part (spherical tensor form) of the potential analytically. But finding this expansion is costly, even more than running Psi4 for every orientation.

\section{Kinetic energy operator}

\section{Hamiltonian}
We decided to keep the bound state Hamiltonian $H_0$ and the initial propagation Hamiltonian $H_{init}$ as separate entities, calculated independently. The computational overhead related to calculating the bound-state part twice is marginal, as we assume that the full propagation basis is much bigger than the basis for the bound Hamiltonian $Nbas \gg Nbas0$. Future releases might recycle the bound state KEO and POT and build only the outside region Hamiltonian.

\section{Wavepacket propagation}
\subsection{time grid}
The time grid for the calculation is determined by the input keywords:
\begin{table}[h!]
	\begin{center}
		\caption{Time grid keywords.}
		\label{tab:time-grids}
		\begin{tabular}{l|c|r}
			\textbf{keyword} & \textbf{description} & \textbf{type}\\
			\hline
			t0 & start time & float\\
			tmax & end time & float\\
			dt & time step & float\\
			time\_units & units & string \\
			wfn\_saverate & save rate of the wavepacket  & float \\
			
		\end{tabular}
	\end{center}
\end{table}

The generated grid is equidistant given by the following formula:
\begin{equation}
t[i] = t_0 + i \cdot dt ;\ i=0,1,2,...,Ntpts
\end{equation}
where 
\begin{equation}
Ntpts = \ceil[\Bigg]{\frac{t_{max}-t_0}{dt}+1}
\end{equation}
such that the array of time-points contains elements: $t[0],t[1],...,t[Ntpts]$.
Note that the last point (tmax) is included in the grid. 


\bibliography{theory}
\end{document}

